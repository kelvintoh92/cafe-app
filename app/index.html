<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Popup Cafe - Order your favorite drinks and pastries.">
    <meta name="keywords" content="cafe, popup, coffee, pastries, order">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <title>Popup Cafe</title>
<style>
:root {
    --primary-color: #111;
    --danger-color: #d00;
    --success-color: #111;
    --text-color: #111;
    --bg-gradient: #fff;
    --white-color: #fff;
    --box-shadow: 0 4px 24px rgba(0,0,0,0.07);
    --border-radius: 12px;
    --font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
}
body {
    font-family: var(--font-family);
    margin: 0;
    padding: 22px;
    background: var(--bg-gradient);
    color: var(--text-color);
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
}
h1, h2 {
    text-align: center;
    font-family: var(--font-family);
    font-weight: 700;
    letter-spacing: 1px;
    margin-top: 0.7em;
    color: var(--primary-color);
}
h1 {
    font-size: 2em;
    background: none;
    color: var(--primary-color);
}
#top-banner {
    width: 100%;
    max-width: 720px;
    height: 140px;
    overflow: hidden;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    margin-bottom: 18px;
    background: #eee;
}
#top-banner img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    border-radius: var(--border-radius);
}
.card-section,
#customer-section,
#order-summary,
.menu-category {
    background: var(--white-color);
    box-shadow: var(--box-shadow);
    border-radius: var(--border-radius);
    padding: 28px 22px;
    margin: 18px 0;
    width: 100%;
    max-width: 520px;
    box-sizing: border-box;
    border: 1px solid #ddd;
}
#customer-section label {
    font-weight: 600;
    margin-bottom: 2px;
    color: var(--primary-color);
    display: block;
    margin-top: 8px;
}
#customer-section input {
    width: 70%;
    padding: 10px;
    font-size: 1em;
    border: 1.5px solid #222;
    border-radius: 8px;
    margin-bottom: 14px;
    background: #fff;
    color: var(--primary-color);
    font-family: var(--font-family);
    display: block;
    box-sizing: border-box;
}
.notification-email {
    font-size: 0.89em;
    color: #555;
    margin-top: 2px;
    margin-bottom: -8px;
    display: block;
}
#toggle-menu {
    margin: 0 auto 26px;
    padding: 11px 22px;
    font-size: 1.08em;
    border: 1.5px solid #111;
    background: #fff;
    color: #111;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    box-shadow: 0 2px 8px rgba(0,0,0,0.07);
    transition: background 0.18s, color 0.18s;
}
#toggle-menu:hover {
    background: #111;
    color: #fff;
}
#menu {
    width: 100%;
    max-width: 720px;
    margin-bottom: 22px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 18px;
}
.menu-category {
    padding: 18px 14px;
    margin-bottom: 12px;
    width: 100%;
    max-width: 600px;
}
.menu-category h2 {
    font-size: 1.2em;
    margin-bottom: 12px;
    color: #111;
}
.menu-items {
    display: flex;
    flex-direction: column;
    gap: 22px;
}
.menu-item {
    background: #fff;
    border-radius: 8px;
    padding: 14px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.03);
    display: grid;
    grid-template-columns: 1.5fr 0.7fr 0.8fr 0.9fr;
    align-items: center;
    gap: 10px;
    border: 1px solid #eee;
}
.item-details h3 {
    margin: 0;
    color: #111;
    font-size: 1.04em;
    font-weight: 600;
}
.item-details .item-description {
    color: #555;
    font-size: 0.96em;
    margin-top: 4px;
}
.item-details select {
    width: 100%;
    padding: 7px;
    border: 1px solid #222;
    border-radius: 8px;
    font-size: 0.96em;
    margin-top: 4px;
    background: #fff;
    color: #111;
}
.item-price {
    text-align: right;
    font-weight: bold;
    color: #111;
    font-size: 1em;
}
.item-quantity-controls {
    display: flex;
    align-items: center;
    gap: 5px;
    justify-self: end;
}
.quantity-btn {
    background: #fff;
    border: 1.5px solid #222;
    color: #111;
    padding: 6px 12px;
    font-size: 1.2em;
    font-weight: bold;
    border-radius: 7px;
    cursor: pointer;
    transition: background 0.18s, color 0.18s;
}
.quantity-btn:hover {
    background: #111;
    color: #fff;
}
.quantity-btn[disabled] {
    opacity: 0.5;
    cursor: not-allowed;
}
.quantity-display {
    width: 30px;
    text-align: center;
    font-weight: bold;
    background: #fff;
    border-radius: 5px;
    border: 1px solid #222;
}
.item-add-button button {
    padding: 9px 14px;
    background: #111;
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1em;
    font-weight: 600;
    box-shadow: 0 2px 8px rgba(0,0,0,0.07);
    transition: background 0.18s, color 0.18s;
}
.item-add-button button:hover {
    background: #fff;
    color: #111;
    border: 1.5px solid #111;
}
#order-summary {
    padding: 24px 18px;
    margin-bottom: 18px;
}
#order-summary h3 {
    font-size: 1.14em;
    margin-top: 0;
    color: #111;
}
#order-summary ul {
    list-style: none;
    padding-left: 0;
    margin-bottom: 16px;
}
.order-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #eee;
}
.order-details {
    display: flex;
    align-items: center;
    gap: 10px;
}
.remove-item-button {
    background-color: #fff;
    color: #d00;
    border: 1px solid #d00;
    border-radius: 7px;
    cursor: pointer;
    padding: 6px 10px;
    font-size: 14px;
    font-weight: 600;
    transition: background 0.2s, color 0.2s;
}
.remove-item-button:hover {
    background-color: #d00;
    color: #fff;
}
.btn {
    padding: 12px;
    width: 100%;
    border: 1.5px solid #111;
    border-radius: 10px;
    font-size: 1.07em;
    cursor: pointer;
    margin-top: 9px;
    color: #fff;
    font-weight: 600;
    background: #111;
    box-shadow: 0 2px 8px rgba(0,0,0,0.07);
    transition: background 0.18s, color 0.18s, border 0.18s;
}
.btn:hover {
    background: #fff;
    color: #111;
    border-color: #111;
}
#clear-btn {
    background: #fff;
    color: #d00;
    border-color: #d00;
}
#clear-btn:hover {
    background: #d00;
    color: #fff;
    border-color: #d00;
}
#submit-btn {
    background: #111;
    color: #fff;
    border-color: #111;
}
#submit-btn:hover {
    background: #fff;
    color: #111;
    border-color: #111;
}
#menu.hidden {
    display: none;
}
.add-confirmation {
    position: fixed;
    top: 23px;
    left: 50%;
    transform: translateX(-50%);
    background: #111;
    color: #fff;
    padding: 12px 26px;
    border-radius: 14px;
    opacity: 0;
    transition: opacity 0.5s, transform 0.3s;
    z-index: 1000;
    font-size: 1.07em;
    font-weight: 600;
    box-shadow: 0 6px 24px rgba(0,0,0,0.13);
}
.add-confirmation.show {
    opacity: 1;
    transform: translateX(-50%) scale(1.08);
}
button:focus, input:focus {
    outline: 2px solid #111;
    outline-offset: 2px;
}

/* Mobile styles */
@media (max-width: 768px) {
    body {
        padding: 8px;
    }
    #menu {
        align-items: stretch;
    }
    .menu-category, #order-summary, .card-section {
        max-width: 100%;
        padding: 12px 6px;
        border-radius: 12px;
    }
    .menu-item {
        grid-template-columns: 1fr;
        gap: 8px;
        padding: 10px;
    }
    .item-details h3 { font-size: 16px; }
    .item-details .item-description { font-size: 14px; }
    .btn, #toggle-menu { font-size: 14px; }
    #customer-section {
        padding: 18px 8px;
    }
    #customer-section input {
        width: 100%;
        margin-bottom: 18px;
    }
    #customer-section label {
        margin-top: 10px;
        margin-bottom: 6px;
    }
</style>
</head>
<body>
    <div id="top-banner">
        <img src="https://cdn.glitch.global/f0a1af0e-37fe-4fa9-ae9c-c0115289ff91/WhatsApp%20Image%202025-04-08%20at%209.08.56%20PM.jpeg?v=1744124496966" alt="Banner Image">
    </div>

    <h1>Welcome to Studio Cafe by DBMK x GIF</h1>

    <div id="customer-section">
        <label for="customer-name">Your Name:</label>
        <input type="text" id="customer-name" placeholder="Enter your name..." />
        <label for="customer-email">Your Email:</label>
        <input type="email" id="customer-email" placeholder="Enter your email..." />
        <small class="notification-email">We'll whisk a receipt to your inbox â€“ just pop in your email.</small>
    </div>

    <button id="toggle-menu">Show Menu</button>

    <section id="menu" class="hidden" aria-hidden="true"></section>

    <section id="order-summary">
        <h3>Order Summary</h3>
        <ul id="order-list" aria-live="polite"></ul>
        <p><strong>Total: RM<span id="total">0.00</span></strong></p>
        <p><em>Kindly complete your payment at the counter.</em></p>
        <button id="submit-btn" class="btn">Submit Order</button>
        <button id="clear-btn" class="btn">Clear Order</button>
    </section>

    <div id="add-confirmation" class="add-confirmation">Item added!</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";

        // Firebase and EmailJS Configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "pop-up-cafe-v2.firebaseapp.com",
            projectId: "pop-up-cafe-v2",
            storageBucket: "pop-up-cafe-v2.firebasestorage.app",
            messagingSenderId: "676149927239",
            appId: "1:676149927239:web:648247bb5c150c9f02c062"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Menu Data
        const menu = [
            { name: "Black", category: "Drinks", options: { "Hot": 10.0, "Iced": 11.0 } },
            { name: "White", category: "Drinks", options: { "Hot": 12.0, "Iced": 13.0 } },
            { name: "Matcha Latte", category: "Drinks", options: { "Hot": 13.0, "Iced": 14.0 } },
            { name: "Hojicha Latte", category: "Drinks", options: { "Hot": 13.0, "Iced": 14.0 } },
            { name: "Matcha Float", category: "Drinks", options: { "Matcha": 15.0, "Roasted Hojicha": 15.0, "Dark Choc Sea Salt": 15.0 }, description: "Matcha latte with a scoop of your choice of gelato." },
            { name: "Affogato", category: "Drinks", options: { "Dark Choc Sea Salt": 18.0, "Hazelnut Orange": 18.0, "PB&J": 18.0 }, description: "Your choice of gelato 'drowned' in a shot of hot espresso." },
            { name: "Dalgona Coffee", category: "Drinks", options: { "Hot": 15.0, "Iced": 15.0 } },
            {
                name: "Gelato",
                category: "Gelato",
                sizes: [
                    { size: "Single Scoop", price: 10.0 },
                    { size: "Double Scoop", price: 18.0 }
                ],
                flavors: ["Dark Choc Sea Salt", "Roasted Hojicha", "Matcha", "Hazelnut Orange"],
                description: "Choose your size and your favorite flavor(s)."
            }
        ];

        // DOM Elements
        const menuDiv = document.getElementById("menu");
        const orderList = document.getElementById("order-list");
        const totalSpan = document.getElementById("total");
        const clearBtn = document.getElementById("clear-btn");
        const submitBtn = document.getElementById("submit-btn");
        const customerNameInput = document.getElementById("customer-name");
        const customerEmailInput = document.getElementById("customer-email");
        const toggleBtn = document.getElementById("toggle-menu");
        const addConfirmationDiv = document.getElementById("add-confirmation");

        let order = [];
        let menuVisible = false;

        // Functions
        const validateEmail = (email) => /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(email);

        const validateCustomerDetails = () => {
            const name = customerNameInput.value.trim();
            const email = customerEmailInput.value.trim();
            if (!name) {
                alert("Please enter your name before placing an order.");
                return false;
            }
            if (!email || !validateEmail(email)) {
                alert("Please enter a valid email address.");
                return false;
            }
            return true;
        };

        const updateOrderDisplay = () => {
            orderList.innerHTML = "";
            let total = 0;
            order.forEach(item => {
                const li = document.createElement("li");
                li.className = "order-item";
                li.innerHTML = `
                    <span>${item.name} x ${item.quantity}</span>
                    <span class="order-details">
                        RM${(item.price * item.quantity).toFixed(2)}
                        <button class="remove-item-button">X</button>
                    </span>
                `;
                li.querySelector(".remove-item-button").addEventListener("click", () => {
                    order = order.filter(orderItem => orderItem.name !== item.name);
                    updateOrderDisplay();
                });
                orderList.appendChild(li);
                total += item.price * item.quantity;
            });
            totalSpan.textContent = total.toFixed(2);
        };

        const showConfirmation = (message) => {
            addConfirmationDiv.textContent = message;
            addConfirmationDiv.classList.add("show");
            setTimeout(() => addConfirmationDiv.classList.remove("show"), 1500);
        };

        const addToOrder = (item) => {
            if (!validateCustomerDetails()) return;
            const existingItem = order.find(orderItem => orderItem.name === item.name);
            if (existingItem) {
                existingItem.quantity += item.quantity;
            } else {
                order.push({ ...item });
            }
            updateOrderDisplay();
            showConfirmation("Item added!");
        };

        const clearOrder = () => {
            order = [];
            updateOrderDisplay();
            showConfirmation("Items cleared!");
        };

        const submitOrder = async () => {
            if (!validateCustomerDetails() || order.length === 0) {
                if (order.length === 0) alert("Your order is empty.");
                return;
            }

            const orderData = {
                customerName: customerNameInput.value.trim(),
                customerEmail: customerEmailInput.value.trim(),
                items: order.map(item => ({ name: item.name, quantity: item.quantity, price: item.price })),
                total: parseFloat(totalSpan.textContent),
                timestamp: new Date()
            };

            try {
                const docRef = await addDoc(collection(db, "orders"), orderData);
                alert(`Order submitted! Document ID: ${docRef.id}`);

                const emailParams = {
                    to_name: orderData.customerName,
                    to_email: orderData.customerEmail,
                    order_id: docRef.id,
                    message: order.map(item => `${item.name} x ${item.quantity} - RM${(item.price * item.quantity).toFixed(2)}`).join("\n"),
                    total: `RM${orderData.total.toFixed(2)}`
                };
                await emailjs.send("service_GIFgelateria", "template_ti1rkn9", emailParams);

                alert("Receipt sent to your email!");
                clearOrder();
            } catch (error) {
                console.error("Error submitting order or sending email:", error);
                alert("There was an error submitting your order or sending the receipt.");
            }
        };

        const toggleMenu = () => {
            menuVisible = !menuVisible;
            menuDiv.classList.toggle("hidden", !menuVisible);
            toggleBtn.textContent = menuVisible ? "Hide Menu" : "Show Menu";
            menuDiv.setAttribute('aria-hidden', !menuVisible);
        };

        const populateMenu = () => {
            menuDiv.innerHTML = '';
            const categories = ["Gelato", "Drinks"];
            categories.forEach(categoryName => {
                const categoryDiv = document.createElement("div");
                categoryDiv.className = "menu-category";
                categoryDiv.innerHTML = `<h2>${categoryName}</h2><div class="menu-items"></div>`;
                const itemsContainer = categoryDiv.querySelector('.menu-items');

                menu.filter(item => item.category === categoryName).forEach(item => {
                    const itemDiv = document.createElement("div");
                    itemDiv.className = "menu-item";

                    let detailsHtml = `<h3>${item.name}</h3>`;
                    let currentPrice = 0;

                    if (item.options) {
                        const optionsKeys = Object.keys(item.options);
                        currentPrice = item.options[optionsKeys[0]];
                        detailsHtml += `<select class="item-options-select">`;
                        for (const option in item.options) {
                            detailsHtml += `<option value="${item.options[option]}">${option}</option>`;
                        }
                        detailsHtml += `</select>`;
                        detailsHtml += item.description ? `<p class="item-description">${item.description}</p>` : '';
                    } else if (item.sizes) {
                        currentPrice = item.sizes[0].price;
                        detailsHtml += `<select class="item-sizes-select">`;
                        item.sizes.forEach(size => {
                            detailsHtml += `<option value="${size.price}">${size.size} - RM${size.price.toFixed(2)}</option>`;
                        });
                        detailsHtml += `</select>`;

                        // First flavor select, always visible
                        detailsHtml += `<div class="flavor-select-container">
                            <label for="flavor1-${item.name.replace(/\s/g, '-')}" style="font-size: 0.9em;">Flavor 1:</label>
                            <select id="flavor1-${item.name.replace(/\s/g, '-')}" class="gelato-flavor-select">
                                ${item.flavors.map(flavor => `<option value="${flavor}">${flavor}</option>`).join('')}
                            </select>
                        </div>`;

                        // Second flavor select, hidden by default
                        detailsHtml += `<div id="flavor2-container" style="display: none;">
                            <label for="flavor2-${item.name.replace(/\s/g, '-')}" style="font-size: 0.9em;">Flavor 2:</label>
                            <select id="flavor2-${item.name.replace(/\s/g, '-')}" class="gelato-flavor-select">
                                ${item.flavors.map(flavor => `<option value="${flavor}">${flavor}</option>`).join('')}
                            </select>
                        </div>`;
                        
                        detailsHtml += item.description ? `<p class="item-description">${item.description}</p>` : '';
                    } else {
                        currentPrice = item.price;
                        detailsHtml += item.description ? `<p class="item-description">${item.description}</p>` : '';
                    }

                    itemDiv.innerHTML = `
                        <div class="item-details">${detailsHtml}</div>
                        <p class="item-price">RM${currentPrice.toFixed(2)}</p>
                        <div class="item-quantity-controls">
                            <button class="quantity-btn minus-btn">-</button>
                            <span class="quantity-display">1</span>
                            <button class="quantity-btn plus-btn">+</button>
                        </div>
                        <div class="item-add-button">
                            <button>Add RM${currentPrice.toFixed(2)}</button>
                        </div>
                    `;

                    const priceElement = itemDiv.querySelector('.item-price');
                    const minusBtn = itemDiv.querySelector(".minus-btn");
                    const plusBtn = itemDiv.querySelector(".plus-btn");
                    const quantityDisplay = itemDiv.querySelector(".quantity-display");
                    const addButton = itemDiv.querySelector(".item-add-button button");
                    let quantity = 1;

                    function updateButtonPrice() {
                        const basePrice = parseFloat(priceElement.textContent.replace('RM', ''));
                        const totalItemPrice = basePrice * quantity;
                        addButton.textContent = `Add RM${totalItemPrice.toFixed(2)}`;
                    }

                    const sizeSelect = itemDiv.querySelector('.item-sizes-select');
                    if (sizeSelect) {
                        const flavor2Container = itemDiv.querySelector('#flavor2-container');
                        sizeSelect.addEventListener('change', (event) => {
                            const selectedPrice = parseFloat(event.target.value);
                            priceElement.textContent = `RM${selectedPrice.toFixed(2)}`;
                            if (event.target.options[event.target.selectedIndex].text.includes("Double Scoop")) {
                                flavor2Container.style.display = 'block';
                            } else {
                                flavor2Container.style.display = 'none';
                            }
                            updateButtonPrice();
                        });
                    }

                    const optionSelect = itemDiv.querySelector('.item-options-select');
                    if(optionSelect) {
                        optionSelect.addEventListener('change', (event) => {
                            const selectedPrice = parseFloat(event.target.value);
                            priceElement.textContent = `RM${selectedPrice.toFixed(2)}`;
                            updateButtonPrice();
                        });
                    }

                    minusBtn.addEventListener("click", () => {
                        if (quantity > 1) {
                            quantity--;
                            quantityDisplay.textContent = quantity;
                            updateButtonPrice();
                        }
                    });

                    plusBtn.addEventListener("click", () => {
                        quantity++;
                        quantityDisplay.textContent = quantity;
                        updateButtonPrice();
                    });
                    
                    addButton.addEventListener("click", () => {
                        let basePrice = parseFloat(priceElement.textContent.replace('RM', ''));
                        let itemName = item.name;

                        if (item.options) {
                            const selectedOption = itemDiv.querySelector('.item-options-select').options[itemDiv.querySelector('.item-options-select').selectedIndex].text;
                            itemName = `${item.name} (${selectedOption})`;
                        } else if (item.sizes) {
                            const selectedSize = itemDiv.querySelector('.item-sizes-select').options[itemDiv.querySelector('.item-sizes-select').selectedIndex].text;
                            const flavor1 = itemDiv.querySelector('#flavor1-' + item.name.replace(/\s/g, '-')).value;
                            itemName = `${item.name} (${selectedSize}, ${flavor1})`;
                            if (selectedSize.includes("Double Scoop")) {
                                const flavor2 = itemDiv.querySelector('#flavor2-' + item.name.replace(/\s/g, '-')).value;
                                itemName = `${item.name} (${selectedSize}, ${flavor1} & ${flavor2})`;
                            }
                        }
                        
                        addToOrder({ name: itemName, price: basePrice, quantity: quantity });
                        
                        // Reset quantity to 1 after adding to order
                        quantity = 1;
                        quantityDisplay.textContent = quantity;
                        updateButtonPrice();
                    });

                    itemsContainer.appendChild(itemDiv);
                });
                menuDiv.appendChild(categoryDiv);
            });
        };

        // Initialize and Event Listeners
        populateMenu();
        toggleBtn.addEventListener("click", toggleMenu);
        clearBtn.addEventListener("click", clearOrder);
        submitBtn.addEventListener("click", submitOrder);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script>
        (function(){
            emailjs.init("apCgXY03qnGQFDXBb");
        })();
    </script>
</body>
</html>
